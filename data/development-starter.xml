<?xml version="1.0" encoding="UTF-8"?>
<book>
    <bookinfo>
        <graphic fileref="logo.jpg"/>
        <productname>eXist-db â€“ Open Source Native XML Database</productname>
        <title>Getting Started with Web Application Development</title>
        <date>October 2012</date>
    </bookinfo>
    <chapter>
        <title>Getting Started with Web Application Development</title>
        <para>Being much more than just an XML Database, eXist-db provides a complete platform for
            the development of rich web applications based on XML and related technologies (XQuery,
            XForms, XSLT, XHTML...).</para>
        <para>Key components of this platform are:</para>
        <itemizedlist>
            <listitem>
                <para>a standardized packaging format for modular applications, allowing deployment
                    into any eXist-db instance</para>
            </listitem>
            <listitem>
                <para>a set of tools to create application packages, integrated into our XQuery IDE,
                    eXide</para>
            </listitem>
            <listitem>
                <para>an HTML templating framework for a clean separation of HTML page content and
                    application logic</para>
            </listitem>
            <listitem>
                <para>a tight integration with XForms for fast form development</para>
            </listitem>
            <listitem>
                <para>a clean approach for the deployment of RESTful services based on XQuery code
                    annotations (RESTXQ)</para>
            </listitem>
        </itemizedlist>
        <para>This tutorial will demonstrate how to quickly prototype an application based on above
            components. Certainly there are many other wasy to integrate eXist-db into your own
            application. This guide describes only one of the many possible approaches. However, we
            have found that taking the first steps is the most difficult part for new users, so we
            tried to make is as simple as possible.</para>
        <section>
            <title>The Packaging</title>
            <para>eXist-db 2.0 builds on the concept of self-contained, modular applications, which
                can be deployed into any database instance using a standardized packaging format.
                Applications live inside the database, so application code, HTML views, associated
                services and data reside in the same place - though maybe in different root
                collections. This makes it easy to e.g. backup an application into the file system,
                pass it to someone else for installation in his own db, or even publish it to
                eXist-db's public repository. The documentation, the dashboard, eXide or the Demo
                are examples for application packages.</para>
            <para>The packaging format is compliant with the expath packaging proposal, though it
                extends it considerably. For distribution, an application is packed into a .xar
                archive, which is basically a ZIP archive containing all the application code (any
                maybe data) required by the application along with a set of descriptors. The
                descriptors describe the application and control the installation process. As an
                absolute minimum, an application package <emphasis>must</emphasis> contain two
                descriptor files: <filename>expath-pkg.xml</filename> and
                    <filename>repo.xml</filename>.  You can read more about those files in the
                package repository documentation, but this is not required for the following
                sections since eXide will create the proper descriptors for us automatically.</para>
        </section>
        <section>
            <title>Starting a New Application</title>
            <para>To start a new application, open <ulink url="../eXide/index.html">eXide</ulink>
                (by clicking the link or via the dashboard or the system tray menu of
                eXist-db).</para>
            <procedure>
                <step>
                    <para>From the main menu, select
                            <guimenuitem>Application</guimenuitem>/<guimenuitem>New
                            Application</guimenuitem>. The Deployment Editor dialog should pop up.
                        If you are not logged in as an admin user yet, you'll first be required to
                        do so.</para>
                </step>
                <step>
                    <para>Fill out the form by choosing a template, target collection, name,
                        abbreviation and title for the application. All other form fields and pages
                        are optional, so just ignore them for now.</para>
                    <figure>
                        <title>Deployment Editor Dialog</title>
                        <mediaobject>
                            <imageobject>
                                <imagedata fileref="resources/new-application-screen.png" scale="75%"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                    <para>The important fields are:</para>
                    <variablelist>
                        <varlistentry>
                            <term>Template</term>
                            <listitem>
                                <para>The template used to generate the new application. Right now
                                    only two templates are available: the "eXist-db Design" template
                                    will be based on the standard eXist-db page layout and design.
                                    The "Plain" template creates a basic page layout without
                                    eXist-db specific stuff. Both templates use the bootstrap CSS
                                    library for styling and the HTML templating XQuery module for a
                                    clean separation of concerns.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term>Target collection</term>
                            <listitem>
                                <para>This is the collection where your app will be installed by
                                    default. Please note that this can be changed by the package
                                    manager during install. It is just a recommendation, not a
                                    requirement.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term>Name</term>
                            <listitem>
                                <para>A unique identifier for the application. The expath proposal
                                    recommends to use a URI here to avoid name collisions.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term>Abbreviation</term>
                            <listitem>
                                <para>A short abbreviation for the application. Among other things,
                                    it will be used as the file name for the final .xar package.  It
                                    is thus best to choose a simple abbreviation without spaces or
                                    punctuation characters.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term>Title</term>
                            <listitem>
                                <para>A short description of the application, which will be
                                    displayed to the user, e.g. in the dashboard.</para>
                            </listitem>
                        </varlistentry>
                    </variablelist>
                </step>
                <step>
                    <para>Click on <guimenuitem>Done</guimenuitem> when you have completed the form.
                        eXide will now generate a collection hierarchy for the application based on
                        the template you had selected. Once this has completed,  the
                            <guimenuitem>Open Document</guimenuitem> dialog will pop up to indicate
                        that you can start editing files.</para>
                    <figure>
                        <title>Open Document Dialog after generating application </title>
                        <mediaobject>
                            <imageobject>
                                <imagedata fileref="resources/new-application-completed.png"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
                <step>
                    <para>To test if the application has been generated properly, select the
                            <filename>index.html</filename> page of the new app in the open dialog
                        and load it into eXide. With <filename>index.html</filename> open, select
                            <guimenuitem>Application</guimenuitem>/<guimenuitem>Run App
                            Source</guimenuitem> from the menu. A small dialog box will pop up,
                        showing you a link to the application.</para>
                    <figure>
                        <title>Run Dialog</title>
                        <mediaobject>
                            <imageobject>
                                <imagedata fileref="resources/new-application-run.png"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                    <para>Click on the link to run the application in a separate browser tab.</para>
                    <figure>
                        <title>The Default Start Page of the Application</title>
                        <mediaobject>
                            <imageobject>
                                <imagedata fileref="resources/new-application-home.png"/>
                            </imageobject>
                        </mediaobject>
                    </figure>
                </step>
            </procedure>
        </section>
        <section>
            <title>Understanding the Default Application Structure</title>
            <para>As you could see, eXide created an application skeleton which worked out of the
                box. All resources of the application reside below the target collection
                    (<filename>/db/tutorial</filename>).</para>
            <para>The generated collection hierarchy follows a certain structure, which is usually
                the same for all apps which ship with eXist-db. The most important collections and
                files are described below:</para>
            <variablelist>
                <varlistentry>
                    <term>/modules/</term>
                    <listitem>
                        <para>Contains XQuery modules. Most of the actual application code
                                should go here.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>/resources/</term>
                    <listitem>
                        <para>Secondary resources like CSS files, images or javascript.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>/templates/</term>
                    <listitem>
                        <para>Page templates containing all the repeating parts of the site's
                                HTML layout, i.e. all the stuff which applies to every HTML view of
                                the application.</para>
                    </listitem>
                </varlistentry>
            </variablelist>
            <variablelist>
                <varlistentry>
                    <term>collection.xconf</term>
                    <listitem>
                        <para>A template file for the index configuration, which should apply to
                                this application. Will be copied into the correct system collection
                                when the application is installed.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>controller.xql</term>
                    <listitem>
                        <para>The URL rewriting controller, which handles the URL space of the
                                application. You will rarely need to change this for simple
                                applications.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>expath-pkg.xml and repo.xml</term>
                    <listitem>
                        <para>Those are the package descriptor files for the application
                                containing the information you entered via the Deployment Editor.
                                You don't need to edit those files directly. Instead, open the
                                Deployment Editor to change any of the descriptor properties.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>index.html</term>
                    <listitem>
                        <para>The default start page of the application.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>pre-install.xql</term>
                    <listitem>
                        <para>An XQuery script which will be run by the package manager
                                    <emphasis>before</emphasis> installing the app. By default, the
                                script only ensures that any index configurations in
                                collection.xconf are properly copied into the corresponding system
                                collection before the app is installed.</para>
                        <para>In addition to <guimenuitem>pre-install.xql</guimenuitem>, you may
                                also define a <guimenuitem>post-install.xql</guimenuitem> script via
                                the Deployment Editor. As the name says, this script will run after
                                the app has been deployed into the database and is most often used
                                to copy resources or run initialization tasks required by the app.
                            </para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
    </chapter>
</book>