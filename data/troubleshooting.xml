<?xml version="1.0" encoding="UTF-8"?>
<book>
    <bookinfo>
        <graphic fileref="logo.jpg"/>
        <productname>eXist-db â€“ Open Source Native XML Database</productname>
        <title>Troubleshooting and Advanced eXist-db Installation Topics</title>
        <date>September 2012</date>
    </bookinfo>
    <chapter>
        <title>Troubleshooting and Advanced Installation Topics</title>
        <section id="starting-up">
            <title>Starting Up</title>
            <para>While eXist-db starts up, log output appears in the console. If eXist launched
                properly, you will find output similar to the following (this example output is
                taken from Mac OS X): </para>
            <example>
                <title>Console Output</title>
                <screen><![CDATA[
Using locale: en_US.UTF-8
04 Nov 2009 18:45:58,346 [main] INFO  (JettyStart.java [run]:90) - Configuring eXist from /Applications/eXist/conf.xml 
04 Nov 2009 18:45:58,346 [main] INFO  (JettyStart.java [run]:91) -  
04 Nov 2009 18:45:58,347 [main] INFO  (JettyStart.java [run]:92) - Running with Java 1.6.0_15 [Apple Inc. (Java HotSpot(TM) 64-Bit Server VM) in /System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home] 
04 Nov 2009 18:45:58,347 [main] INFO  (JettyStart.java [run]:97) -  
04 Nov 2009 18:45:58,347 [main] INFO  (JettyStart.java [run]:101) - [eXist Version : 1.4.0] 
04 Nov 2009 18:45:58,347 [main] INFO  (JettyStart.java [run]:103) - [eXist Build : 20091104] 
04 Nov 2009 18:45:58,348 [main] INFO  (JettyStart.java [run]:105) - [eXist Home : /Applications/eXist] 
04 Nov 2009 18:45:58,348 [main] INFO  (JettyStart.java [run]:107) - [SVN Revision : 10364] 
04 Nov 2009 18:45:58,348 [main] INFO  (JettyStart.java [run]:115) - [Operating System : Mac OS X 10.6.1 x86_64] 
04 Nov 2009 18:45:58,349 [main] INFO  (JettyStart.java [run]:118) - [jetty.home : /Applications/eXist/tools/jetty] 
04 Nov 2009 18:45:58,349 [main] INFO  (JettyStart.java [run]:120) - [log4j.configuration : file:/Applications/eXist/log4j.xml] 
04 Nov 2009 18:45:59,871 [main] INFO  (FileResource.java [<clinit>]:60) - Checking Resource aliases 
04 Nov 2009 18:45:59,989 [main] INFO  (HttpServer.java [setStatsOn]:1130) - Statistics on = false for org.mortbay.jetty.Server@4cc72243 
04 Nov 2009 18:45:59,994 [main] INFO  (HttpServer.java [doStart]:684) - Version Jetty/5.1.12 
04 Nov 2009 18:46:00,336 [main] INFO  (Container.java [start]:74) - Started org.mortbay.jetty.servlet.WebApplicationHandler@1f758cd1 
Logging already initialized. Skipping...
04 Nov 2009 18:46:01,214 [main] INFO  (Container.java [start]:74) - Started WebApplicationContext[/exist,eXist XML Database] 
04 Nov 2009 18:46:01,231 [main] INFO  (SocketListener.java [start]:205) - Started SocketListener on 0.0.0.0:8080 
04 Nov 2009 18:46:01,232 [main] INFO  (Container.java [start]:74) - Started org.mortbay.jetty.Server@4cc72243 
04 Nov 2009 18:46:01,232 [main] INFO  (JettyStart.java [run]:174) - ---------------------------------------------------------------- 
04 Nov 2009 18:46:01,232 [main] INFO  (JettyStart.java [run]:175) - eXist-db has started on port 8080. Configured contexts: 
04 Nov 2009 18:46:01,233 [main] INFO  (JettyStart.java [run]:177) - http://localhost:8080/exist 
04 Nov 2009 18:46:01,233 [main] INFO  (JettyStart.java [run]:179) - ---------------------------------------------------------------- 
]]></screen>
            </example>
            <para>When you see the "eXist-db has started" message, you know that your eXist
                installation works. However, if the above start-up fails, ensure the
                    <envar>JAVA_HOME</envar> and <envar>EXIST_HOME</envar> environment variables -
                the eXist and Java JDK root directory paths - point to the correct locations. Both
                variables are used in the <filename>startup.bat</filename> and
                    <filename>startup.sh</filename> scripts and have to be set correctly before the
                scripts are run (you can also insert the lines required in the beginning of the
                scripts themselves).</para>
            <itemizedlist>
                <listitem>
                    <para>
                        <envar>JAVA_HOME</envar> should point to the directory where the Java JDK is
                        installed. A common problem is that the path added by the installer points
                        to the JRE, not the JDK. For instructions about how to set JAVA_HOME on
                        Windows, follow the instructions in this <ulink
                            url="http://confluence.atlassian.com/display/DOC/Setting+the+JAVA_HOME+Variable+in+Windows"
                            >guide</ulink>; on Linux, follow this <ulink
                            url="http://www.cyberciti.biz/faq/linux-unix-set-java_home-path-variable/"
                            >guide</ulink>, and on Mac OS X, follow this <ulink
                            url="http://www.mehtanirav.com/2008/09/02/setting-java_home-on-mac-os-x-105"
                            >guide</ulink>. </para>
                </listitem>
                <listitem>
                    <para>
                        <envar>EXIST_HOME</envar> should point to the directory that contains the
                        configuration file <filename moreinfo="none">conf.xml</filename>, so that
                        the server uses the path <filename>EXIST_HOME/conf.xml</filename>. For
                        example, if the <envar>EXIST_HOME</envar> path is <filename>C:\Program
                            Files\eXist</filename>, the server will look for <filename>C:\Program
                            Files\eXist\conf.xml</filename>. You can set EXIST_HOME in the same way
                        that you set JAVA_HOME; thus, on Mac OS X, you would enter "export
                        EXIST_HOME=/Applications/eXist" in the Terminal. </para>
                </listitem>
            </itemizedlist>
            <para>You should also ensure that you have "write" permissions set for the <filename
                    moreinfo="none">data</filename> directory located in <filename moreinfo="none"
                    >webapp/WEB-INF/</filename>.</para>

        </section>
        <section id="port-conflicts">
            <title>Port Conflicts</title>
            <para>eXist-db, through Jetty, by default uses port 8080. There may be other services on
                your system using this port. To see whether this is the case, enter <ulink
                    url="http://localhost:8080/">http://localhost:8080/</ulink> in your browser. If
                another service occupies this port, you cannot start up eXist-db unless you shut
                down the service in question or make eXist-db use another port. To make eXist-db use
                another port, open the file <filename moreinfo="none"
                    >/tools/jetty/etc/jetty.xml</filename> inside your eXist-db installation in a
                text or XML editor and change the value "8080" in</para>
            <synopsis format="linespecific">&lt;Set name="port"&gt;&lt;SystemProperty name="jetty.port" default="8080"/&gt;&lt;/Set&gt;</synopsis>
            <para>to a port that is not used, e.g. "8899":</para>
            <synopsis format="linespecific">&lt;Set name="port"&gt;&lt;SystemProperty name="jetty.port" default="8899"/&gt;&lt;/Set&gt;</synopsis>
            <para>eXist-db uses port 8443 for confidential communication. Another service may also
                be using this port. To make eXist-db use another port, open the file <filename
                    moreinfo="none">/tools/jetty/etc/jetty.xml</filename> and change the value
                "8443" in</para>
            <synopsis format="linespecific">&lt;Set name="confidentialPort"&gt;8443&lt;/Set&gt;</synopsis>
            <para>and</para>
            <synopsis format="linespecific">&lt;Set name="Port"&gt;8443&lt;/Set&gt;</synopsis>
            <para>to a port that is not used, e.g. "8444".</para>
            <!-- Installation on a headless system does not belong in a quick start. Jens Petersen. 
            <note>
                <para>The eXist installer requires a graphical desktop in order to launch. However, If you wish to install eXist on a headless system, use the
                        <command>-p</command> parameter when following <emphasis>Option Two</emphasis> above. This will automatically start the installation.
                    Option <command>-p</command> expects a single parameter: the path to the directory where you would like to install eXist. For
                    example:</para>
                <synopsis>java -jar eXist-{version}.jar -p /usr/local/exist</synopsis>
            </note>
-->
            <para>If these scripts do not launch eXist, you can launch it by changing to the
                directory where you installed eXist and entering the following into the
                console:</para>
            <synopsis>java -Xmx512M -Djava.endorsed.dirs=lib/endorsed -jar start.jar jetty</synopsis>
            <para>If you have problems running the shell/batch scripts, read <ulink url="#appendix"
                    >Running Executable Files</ulink> below.</para>
        </section>
        <section id="administering">
            <title>Administering eXist with the Java Admin Client</title>
            <para>In addition to the Admin webpage, eXist provides a Java-based Admin Client. This
                application enables users to perform more complex administrative tasks, such as user
                management, security settings, batch import of whole directories, and backup/restore
                of the database. </para>
            <para><!-- This GUI client can be used either as a graphical interface, or through a DOS or
                Unix command-line - which uses parameter options for specific tasks. If no action is
                specified on the command-line, the client will enter "interactive mode" and display
                a graphical login interface. -->
                Additional information on using the Admin Client from the command line is available
                in the section on <ulink url="client.xml">Using the Java Client on the Command
                    Line</ulink>.</para>
            <para>You can launch the client by doing one of the following:</para>
            <procedure>
                <step>
                    <para>Windows and Linux users can double-click on the desktop shortcut icon (if
                        created) or select the shortcut icon from the start menu (if created)</para>
                </step>
                <step>
                    <para>or launch using Java WebStart:</para>
                    <para>
                        <ulink url="webstart/exist.jnlp">
                            <inlinemediaobject>
                                <imageobject>
                                    <imagedata fileref="resources/webstart.small.jpg"/>
                                </imageobject>
                            </inlinemediaobject>
                        </ulink>
                    </para>
                    <para>You can also find the Java WebStart launch icon in the Administration menu
                        in the left sidebar of all documentation pages.
                        <!--NOTE: Java WebStart needs to be found by the web
                        browser and the eXist jars need to be signed (if you compiled them
                        yourself)!-->
                    </para>
                </step>
                <step>
                    <para>or enter the following in a Unix shell or DOS/Windows command prompt (with
                        JAVA_HOME set correctly):</para>
                    <synopsis format="linespecific">bin\client.bat (DOS/Windows)</synopsis>
                    <synopsis format="linespecific">bin/client.sh (Unix)</synopsis>
                </step>
                <step>
                    <para>or you can enter the following on the command-line:</para>
                    <synopsis>java -jar start.jar client</synopsis>
                </step>
            </procedure>
            <informaltable>
                <tgroup cols="2">
                    <tbody>
                        <tr>
                            <td>
                                <para>A screenshot of the client login interface is shown on the
                                    right. In the login window, you can provide your username and
                                    password, and select a server. The client can either connect to
                                    a Remote server, or launch an Embedded database (i.e. a database
                                    embedded in an application which runs in the same process as the
                                    client). <!--I don't quite understand this. -Jens Petersen-->
                                    For now, you should run the client remotely (running eXist on
                                    localhost is also running it remotely).
                                    <!--The "embedded" option is useful for backup/restore or mass uploads
                                    of data (writing to an embedded instance avoids the network
                                    overhead).-->
                                </para>
                                <para>If you connect to a remote database, the URL field specifies
                                    the location of the database server. For the standard database
                                    setup used here, use the displayed default URI
                                    (xmldb:exist://localhost:8080/exist/xmlrpc). More information on
                                    server URIs and their function can be found in the guide to
                                        <ulink url="deployment.xml">Database
                                    Deployment</ulink>.</para>
                                <!-- <para>To log in to eXist's default administrator account, use the
                                    "admin" username. if you have not yet changed the admin password
                                    (e.g. if this is your first log in), leave the password field empty. After
                                    clicking "OK", the main client window will open (see the next
                                    screenshot).</para>
                                -->
                            </td>
                            <td>
                                <screenshot>
                                    <graphic fileref="resources/client1.png"/>
                                </screenshot>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <para>Once you have logged in, a client window will open. This
                                    window is split into two panels, and has a top menu and a
                                    toolbar. The top panel lists the database collections; the
                                    bottom panel is the "shell" and has a command prompt. This shell
                                    allows you to manually enter database commands. Most commands,
                                    however, can be entered using the menu. All of the menu and
                                    toolbar items have tooltips that explain their functions.</para>
                            </td>
                            <td>
                                <screenshot>
                                    <graphic fileref="resources/client2.png"/>
                                </screenshot>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <para>If eXist is online, you expose it to exploitation if you use
                                    an empty admin password. If you did not specify an admin
                                    password during installation, you are strongly advised to set an
                                    admin password as soon as possible. You can do this in the Java
                                    Admin Client by following these steps:</para>
                                <orderedlist>
                                    <listitem>
                                        <para>Open the "Edit Users" window by selecting the "Manage
                                            Users" icon (image of a pair of keys) in the
                                            toolbar</para>
                                    </listitem>
                                    <listitem>
                                        <para>At the top, select the "admin" user in the table of
                                            users</para>
                                    </listitem>
                                    <listitem>
                                        <para>Type in the new password into the password
                                            fields</para>
                                    </listitem>
                                    <listitem>
                                        <para>Click the "Modify User" button to apply the
                                            changes</para>
                                    </listitem>
                                </orderedlist>
                            </td>
                            <td>
                                <screenshot>
                                    <graphic fileref="resources/client3.png"/>
                                </screenshot>
                            </td>
                        </tr>
                    </tbody>
                </tgroup>
            </informaltable>
        </section>

        <section id="sect9">
            <title>Starting eXist as a Service</title>

            <para>Instead of manually running the eXist server in a shell window, you may prefer to
                run it as a background service which is automatically launched during system
                startup. eXist comes with pre-configured scripts that use Tanuki Software's <ulink
                    url="http://wrapper.tanukisoftware.org">Java Service Wrapper</ulink> to handle
                the setup procedure. The required scripts are contained in the directory
                    <filename>tools/wrapper</filename>. On Windows, you can simply choose the option
                to <emphasis>Install eXist as Service</emphasis> from the eXist menu created in the
                start menu. You can also call <filename>tools/wrapper/bin/install.bat</filename>
                instead. This will install eXist and Jetty as a Windows service.</para>
            <note>
                <para>Installing eXist as a service on Windows Vista requires full administrator
                    rights. Right click on the start menu item and select "Run as administrator".
                    You may need to do this even if you are already logged in as an
                    administrator.</para>
            </note>
            <para>After executing the install.bat script, you should find eXist listed in the list
                of services currently registered with Windows:</para>
            <screenshot>
                <graphic fileref="resources/services.png"/>
            </screenshot>
            <para>Once the service is registered, you can launch it via the service manager as shown
                in the screenshot or from the command line:</para>
            <synopsis>
                cd tools\wrapper\bin
                wrapper.exe [can't have 2 adjoining hyphens in comments! so take out this space: - -]start ..\conf\wrapper.conf
            </synopsis>
            <para>For Linux, all of the start/shutdown scripts can be found in
                    <filename>tools/wrapper/bin/exist.sh</filename>. You can create a link to this
                file from the <filename>init.d</filename> directory of your distribution (where all
                of the start/shutdown scripts reside). Normally, the directory will be
                    <filename>/etc/init.d</filename>. For example:</para>
            <synopsis>ln -s $EXIST_HOME/tools/wrapper/bin/exist.sh /etc/init.d/exist</synopsis>
            <para>You can then add the service to the correct system runlevel. Check with your Linux
                distribution for instructions.</para>
        </section>

        <section id="troubleshooting">
            <title>If Something Goes Wrong ...</title>
            <para>If you experience any problems while installing eXist, your first step should be
                to check the log files to get additional information about the source of the
                problem. eXist uses the <emphasis>log4j-package</emphasis> to write output logs to
                files. By default, this output is written to the directory <filename moreinfo="none"
                    >webapp/WEB-INF/logs</filename>.
                <!--Or, if you are running eXist as a Windows or
                Unix service, check the directory <filename>tools/wrapper/logs</filename>. -->The
                main log files for eXist itself are <filename>exist.log</filename> and
                    <filename>xmldb.log</filename>.
                <!-- The other log files show output from Cocoon.  -->
            </para>
            <para>If you encounter a problem you are unable to fix, check the <ulink
                    url="index.xml#mailinglists">mailing list</ulink> archives for postings on
                similar errors. If you cannot find a posting, or you are still unsure about the
                problem, consider posting your problem on the list for feedback. If you do decide to
                post a message, please include any exception message you find, both in the logs and
                the
                console<!--, and ensure you post the server-side, and not the client-side messages
                (client-side messages such as browser errors are not useful for
                troubleshooting)-->.</para>
        </section>
        <section id="bin-executables">
            <title>Running Executable Files</title>
            <para>Included in the distribution are a number of useful <filename>.sh</filename> (Unix
                Shell) and <filename>.bat</filename> (DOS batch) programs located in the
                    <filename>bin</filename> directory. If you installed the source distribution or
                used the installer, you can find this directory in the root directory of the
                distribution.
                <!-- If
                you installed the <filename>exist.war</filename> file (Web Application Archive), you
                will find the <filename>bin</filename> directory in the location the <filename
                >.war</filename> file was unpacked. </para>
            <para>These shell and batch scripts are simply wrappers (interfaces between the
                executable Java programs) around the bootstrap loader contained in the jar file
                <filename>start.jar</filename>.-->
            </para>
            <para>If you find the programs do not launch, you can also manually launch these files
                on the command-line, and specify which application you would like to start.</para>
            <para>To manually launch these scripts:</para>
            <variablelist>
                <varlistentry>
                    <term>startup.sh (Unix) / startup.bat (Windows)</term>
                    <listitem>
                        <para>Enter on the command-line:</para>
                        <synopsis>java -jar start.jar jetty</synopsis>
                        <para>Description: Starts the included Jetty web server at port 8080. eXist
                            <!--and Cocoon (a web development framework) are --> is installed as a
                            web application, located at <ulink url="http://localhost:8080/exist/"
                                >http://localhost:8080/exist/</ulink>. </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>shutdown.sh (Unix) / shutdown.bat (Windows)</term>
                    <listitem>
                        <para>Enter on the command-line:</para>
                        <synopsis>java -jar start.jar shutdown</synopsis>
                        <para>Description: Closes the running instance of eXist. If eXist has been
                            started with <filename>startup.sh</filename>, calling
                                <filename>shutdown.sh</filename> will also stop the Jetty web
                            server. Otherwise, only the database is stopped by this call, since
                            eXist has no control over the environment in which it is running. You
                            should <emphasis>always</emphasis> call <filename>shutdown</filename>
                            before killing the server process.
                            <!--This issue is discussed in detail in
                            the succeeding section <emphasis>Shutting Down the
                            Database</emphasis>.-->
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>server.sh (Unix) / server.bat (Windows)</term>
                    <listitem>
                        <para>Enter on the command-line:</para>
                        <synopsis>java -jar start.jar server</synopsis>
                        <para>Description: Launches eXist as a stand-alone server process. In this
                            setup, eXist is only accessible through the XMLRPC and the simple,
                            built-in HTTP interface.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>client.sh (Unix) / client.bat (Windows)</term>
                    <listitem>
                        <para>Enter on the command-line:</para>
                        <synopsis>java -jar start.jar client</synopsis>
                        <para>Description: Launches the Java Administration Client - a graphical
                            database interface. By default, this application is also launched if no
                            application is selected on the command-line:</para>
                        <synopsis>java -jar start.jar</synopsis>
                        <!-- <para>The Java Admin Client is discussed in detail the succeeding section
                            <emphasis>Java Admin Client</emphasis></para> -->
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
    </chapter>
</book>
